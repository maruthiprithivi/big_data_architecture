module.exports=[80886,(e,t,r)=>{"use strict";var n,o;function a({level:e,module:t,message:r}){let n=new Date().toISOString();return`[${n}][${e}][@clickhouse/client][${t}] ${r}`}Object.defineProperty(r,"__esModule",{value:!0}),r.ClickHouseLogLevel=r.LogWriter=r.DefaultLogger=void 0,r.DefaultLogger=class{trace({module:e,message:t,args:r}){let n=[a({module:e,message:t,level:"TRACE"})];r&&n.push("\nArguments:",r),console.debug(...n)}debug({module:e,message:t,args:r}){let n=[a({module:e,message:t,level:"DEBUG"})];r&&n.push("\nArguments:",r),console.debug(...n)}info({module:e,message:t,args:r}){let n=[a({module:e,message:t,level:"INFO"})];r&&n.push("\nArguments:",r),console.info(...n)}warn({module:e,message:t,args:r,err:n}){let o=[a({module:e,message:t,level:"WARN"})];r&&o.push("\nArguments:",r),n&&o.push("\nCaused by:",n),console.warn(...o)}error({module:e,message:t,args:r,err:n}){let o=[a({module:e,message:t,level:"ERROR"})];r&&o.push("\nArguments:",r),o.push("\nCaused by:",n),console.error(...o)}},r.LogWriter=class{constructor(e,t,r){Object.defineProperty(this,"logger",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"module",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"logLevel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.logLevel=r??n.OFF,this.info({message:`Log level is set to ${n[this.logLevel]}`})}trace(e){this.logLevel<=n.TRACE&&this.logger.trace({...e,module:e.module??this.module})}debug(e){this.logLevel<=n.DEBUG&&this.logger.debug({...e,module:e.module??this.module})}info(e){this.logLevel<=n.INFO&&this.logger.info({...e,module:e.module??this.module})}warn(e){this.logLevel<=n.WARN&&this.logger.warn({...e,module:e.module??this.module})}error(e){this.logLevel<=n.ERROR&&this.logger.error({...e,module:e.module??this.module})}},(o=n||(r.ClickHouseLogLevel=n={}))[o.TRACE=0]="TRACE",o[o.DEBUG=1]="DEBUG",o[o.INFO=2]="INFO",o[o.WARN=3]="WARN",o[o.ERROR=4]="ERROR",o[o.OFF=127]="OFF"},62535,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.defaultJSONHandling=void 0,r.defaultJSONHandling={parse:JSON.parse,stringify:JSON.stringify}},36135,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.prepareConfigWithURL=function(e,t,r){let n,o={...e};void 0!==o.additional_headers&&(t.warn({module:"Config",message:'"additional_headers" is deprecated. Use "http_headers" instead.'}),o.http_headers=o.additional_headers,delete o.additional_headers),void 0!==o.host?(t.warn({module:"Config",message:'"host" is deprecated. Use "url" instead.'}),n=s(o.host),delete o.host):n=s(o.url);let[l,u]=i(n,r),c=a(o,u,t);return void 0!==c.pathname&&(l.pathname=c.pathname),c.url=l,c},r.getConnectionParams=function(e,t){let r;if(void 0!==e.access_token){if(void 0!==e.username||void 0!==e.password)throw Error("Both access token and username/password are provided in the configuration. Please use only one authentication method.");r={access_token:e.access_token,type:"JWT"}}else r={username:e.username??"default",password:e.password??"",type:"Credentials"};return{auth:r,url:e.url,application_id:e.application,request_timeout:e.request_timeout??3e4,max_open_connections:e.max_open_connections??10,compression:{decompress_response:e.compression?.response??!1,compress_request:e.compression?.request??!1},database:e.database??"default",log_writer:new n.LogWriter(t,"Connection",e.log?.level),keep_alive:{enabled:e.keep_alive?.enabled??!0},clickhouse_settings:e.clickhouse_settings??{},http_headers:e.http_headers??{},json:{...o.defaultJSONHandling,...e.json}}},r.mergeConfigs=a,r.createUrl=s,r.loadConfigOptionsFromURL=i,r.booleanConfigURLValue=l,r.numberConfigURLValue=u,r.enumConfigURLValue=c;let n=e.r(80886),o=e.r(62535);function a(e,t,r){let n={...e};return!function e(t,n,o=[]){for(let a of Object.keys(n))if("object"==typeof n[a])e(t,n[a],o.concat(a));else{let e=t;for(let t of o)void 0===e[t]&&(e[t]={}),e=e[t];if(void 0!==e[a]){let e=o.concat(a).join(".");r.warn({module:"Config",message:`"${e}" is overridden by a URL parameter.`})}e[a]=n[a]}}(n,t),n}function s(e){let t;try{if(!("string"==typeof e||e instanceof URL))return new URL("http://localhost:8123");t=new URL(e)}catch(e){throw Error("ClickHouse URL is malformed. Expected format: http[s]://[username:password@]hostname:port[/database][?param1=value1&param2=value2]",{cause:e})}if("http:"!==t.protocol&&"https:"!==t.protocol)throw Error(`ClickHouse URL protocol must be either http or https. Got: ${t.protocol}`);return t}function i(e,t){let r={};""!==e.username&&(r.username=decodeURIComponent(e.username)),""!==e.password&&(r.password=decodeURIComponent(e.password)),e.pathname.trim().length>1&&(r.database=e.pathname.slice(1));let o=[...e.searchParams.keys()];if(o.length>0){let a=new Set,s="clickhouse_setting_",i="http_header_";if(o.forEach(t=>{let o=!0,d=e.searchParams.get(t);if(t.startsWith(s)){let e=t.slice(s.length);void 0===r.clickhouse_settings&&(r.clickhouse_settings={}),r.clickhouse_settings[e]=d}else if(t.startsWith("ch_")){let e=t.slice(3);void 0===r.clickhouse_settings&&(r.clickhouse_settings={}),r.clickhouse_settings[e]=d}else if(t.startsWith(i)){let e=t.slice(i.length);void 0===r.http_headers&&(r.http_headers={}),r.http_headers[e]=d}else switch(t){case"application":r.application=d;break;case"pathname":r.pathname=d;break;case"session_id":r.session_id=d;break;case"request_timeout":r.request_timeout=u({key:t,value:d,min:0});break;case"max_open_connections":r.max_open_connections=u({key:t,value:d,min:1});break;case"compression_request":void 0===r.compression&&(r.compression={}),r.compression.request=l({key:t,value:d});break;case"compression_response":void 0===r.compression&&(r.compression={}),r.compression.response=l({key:t,value:d});break;case"log_level":void 0===r.log&&(r.log={}),r.log.level=c({key:t,value:d,enumObject:n.ClickHouseLogLevel});break;case"keep_alive_enabled":void 0===r.keep_alive&&(r.keep_alive={}),r.keep_alive.enabled=l({key:t,value:d});break;case"access_token":r.access_token=d;break;default:o=!1,a.add(t)}o&&e.searchParams.delete(t)}),null!==t){let n=t(r,e);r=n.config,a.size>0&&n.handled_params.forEach(e=>a.delete(e)),n.unknown_params.size>0&&n.unknown_params.forEach(e=>a.add(e))}if(a.size>0)throw Error(`Unknown URL parameters: ${Array.from(a).join(", ")}`)}return[new URL(`${e.protocol}//${e.host}`),r]}function l({key:e,value:t}){let r=t.trim();if("true"===r||"1"===r)return!0;if("false"===r||"0"===r)return!1;throw Error(`"${e}" has invalid boolean value: ${r}. Expected one of: 0, 1, true, false.`)}function u({key:e,value:t,min:r,max:n}){let o=t.trim(),a=Number(o);if(isNaN(a))throw Error(`"${e}" has invalid numeric value: ${o}`);if(void 0!==r&&a<r)throw Error(`"${e}" value ${o} is less than min allowed ${r}`);if(void 0!==n&&a>n)throw Error(`"${e}" value ${o} is greater than max allowed ${n}`);return a}function c({key:e,value:t,enumObject:r}){let n=Object.keys(r).filter(e=>isNaN(Number(e))),o=t.trim();if(!n.includes(o)){let t=n.join(", ");throw Error(`"${e}" has invalid value: ${o}. Expected one of: ${t}.`)}return r[o]}},74615,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ClickHouseClient=void 0;let n=e.r(81360),o=e.r(36135);class a{constructor(e){Object.defineProperty(this,"clientClickHouseSettings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"connectionParams",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"connection",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"makeResultSet",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"valuesEncoder",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sessionId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logWriter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"jsonHandling",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const t=e?.log?.LoggerClass?new e.log.LoggerClass:new n.DefaultLogger,r=(0,o.prepareConfigWithURL)(e,t,e.impl.handle_specific_url_params??null);this.connectionParams=(0,o.getConnectionParams)(r,t),this.logWriter=this.connectionParams.log_writer,this.clientClickHouseSettings=this.connectionParams.clickhouse_settings,this.sessionId=e.session_id,this.role=e.role,this.connection=e.impl.make_connection(r,this.connectionParams),this.makeResultSet=e.impl.make_result_set,this.jsonHandling={...n.defaultJSONHandling,...e.json},this.valuesEncoder=e.impl.values_encoder(this.jsonHandling)}async query(e){var t,r;let n=e.format??"JSON",o=(t=e.query,r=n,(t=s(t=t.trim()))+" \nFORMAT "+r),a=this.withClientQueryParams(e),{stream:i,query_id:l,response_headers:u}=await this.connection.query({query:o,...a});return this.makeResultSet(i,n,l,e=>{this.logWriter.error({err:e,module:"Client",message:"Error while processing the ResultSet.",args:{session_id:a.session_id,role:a.role,query:o,query_id:l}})},u,this.jsonHandling)}async command(e){let t=s(e.query.trim());return await this.connection.command({query:t,...this.withClientQueryParams(e)})}async exec(e){let t=s(e.query.trim()),r="values"in e?e.values:void 0,n=e.decompress_response_stream??!0,o=e.ignore_error_response??!1;return await this.connection.exec({query:t,values:r,decompress_response_stream:n,ignore_error_response:o,...this.withClientQueryParams(e)})}async insert(e){if(Array.isArray(e.values)&&0===e.values.length)return{executed:!1,query_id:"",response_headers:{}};let t=e.format||"JSONCompactEachRow";this.valuesEncoder.validateInsertValues(e.values,t);let r=function(e,t){let r="";if(void 0!==e.columns)if(Array.isArray(e.columns)&&e.columns.length>0)r=` (${e.columns.join(", ")})`;else{var n;null!=(n=e.columns)&&"object"==typeof n&&Object.prototype.hasOwnProperty.call(n,"except")&&e.columns.except.length>0&&(r=` (* EXCEPT (${e.columns.except.join(", ")}))`)}return`INSERT INTO ${e.table.trim()}${r} FORMAT ${t}`}(e,t);return{...await this.connection.insert({query:r,values:this.valuesEncoder.encodeValues(e.values,t),...this.withClientQueryParams(e)}),executed:!0}}async ping(e){return await this.connection.ping(e??{select:!1})}async close(){return await this.connection.close()}async [Symbol.asyncDispose](){await this.close()}withClientQueryParams(e){return{clickhouse_settings:{...this.clientClickHouseSettings,...e.clickhouse_settings},query_params:e.query_params,abort_signal:e.abort_signal,query_id:e.query_id,session_id:e.session_id??this.sessionId,role:e.role??this.role,auth:e.auth,http_headers:e.http_headers}}}function s(e){let t=e.length;for(let r=t;r>0;r--)if(";"!==e[r-1]){t=r;break}return t!==e.length?e.slice(0,t):e}r.ClickHouseClient=a},93657,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.StreamableFormats=r.SupportedRawFormats=r.SupportedJSONFormats=r.SingleDocumentJSONFormats=r.RecordsJSONFormats=r.StreamableJSONFormats=void 0,r.isNotStreamableJSONFamily=function(e){return r.SingleDocumentJSONFormats.includes(e)||r.RecordsJSONFormats.includes(e)},r.isStreamableJSONFamily=function(e){return r.StreamableJSONFormats.includes(e)},r.isSupportedRawFormat=function(e){return r.SupportedRawFormats.includes(e)},r.validateStreamFormat=function(e){if(!r.StreamableFormats.includes(e))throw Error(`${e} format is not streamable. Streamable formats: ${r.StreamableFormats.join(",")}`);return!0},r.encodeJSON=function(e,t,n){if(r.SupportedJSONFormats.includes(t))return n(e)+"\n";throw Error(`The client does not support JSON encoding in [${t}] format.`)},r.StreamableJSONFormats=["JSONEachRow","JSONStringsEachRow","JSONCompactEachRow","JSONCompactStringsEachRow","JSONCompactEachRowWithNames","JSONCompactEachRowWithNamesAndTypes","JSONCompactStringsEachRowWithNames","JSONCompactStringsEachRowWithNamesAndTypes","JSONEachRowWithProgress"],r.RecordsJSONFormats=["JSONObjectEachRow"],r.SingleDocumentJSONFormats=["JSON","JSONStrings","JSONCompact","JSONCompactStrings","JSONColumnsWithMetadata"],r.SupportedJSONFormats=[...r.RecordsJSONFormats,...r.SingleDocumentJSONFormats,...r.StreamableJSONFormats],r.SupportedRawFormats=["CSV","CSVWithNames","CSVWithNamesAndTypes","TabSeparated","TabSeparatedRaw","TabSeparatedWithNames","TabSeparatedWithNamesAndTypes","CustomSeparated","CustomSeparatedWithNames","CustomSeparatedWithNamesAndTypes","Parquet"],r.StreamableFormats=[...r.StreamableJSONFormats,...r.SupportedRawFormats]},5832,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.TupleParam=void 0,r.formatQueryParams=function({value:e,wrapStringInQuotes:t,printNullAsKeyword:r}){return o({value:e,wrapStringInQuotes:t,printNullAsKeyword:r,isInArrayOrTuple:!1})};class n{constructor(e){Object.defineProperty(this,"values",{enumerable:!0,configurable:!0,writable:!0,value:e})}}function o({value:e,wrapStringInQuotes:t,printNullAsKeyword:r,isInArrayOrTuple:d}){if(null==e)return r?"NULL":"\\N";if(Number.isNaN(e))return"nan";if(e===1/0)return"+inf";if(e===-1/0)return"-inf";if("number"==typeof e||"bigint"==typeof e)return String(e);if("boolean"==typeof e)return d?e?"TRUE":"FALSE":e?"1":"0";if("string"==typeof e){let r="";for(let t=0;t<e.length;t++)switch(e.charCodeAt(t)){case s:r+="\\t";break;case i:r+="\\n";break;case l:r+="\\r";break;case u:r+="\\'";break;case c:r+="\\\\";break;default:r+=e[t]}return t?`'${r}'`:r}if(Array.isArray(e))return`[${e.map(e=>o({value:e,wrapStringInQuotes:!0,printNullAsKeyword:!0,isInArrayOrTuple:!0})).join(",")}]`;if(e instanceof Date){let t=Math.floor(e.getTime()/1e3).toString().padStart(10,"0"),r=e.getUTCMilliseconds();return 0===r?t:`${t}.${r.toString().padStart(3,"0")}`}if(e instanceof n)return`(${e.values.map(e=>o({value:e,wrapStringInQuotes:!0,printNullAsKeyword:!0,isInArrayOrTuple:!0})).join(",")})`;if(e instanceof Map)return a(e.entries());if("object"==typeof e)return a(Object.entries(e));throw Error(`Unsupported value in query parameters: [${e}].`)}function a(e){let t=[];for(let[r,n]of e)t.push(`${o({value:r,wrapStringInQuotes:!0,printNullAsKeyword:!0,isInArrayOrTuple:!0})}:${o({value:n,wrapStringInQuotes:!0,printNullAsKeyword:!0,isInArrayOrTuple:!0})}`);return`{${t.join(",")}}`}r.TupleParam=n;let s=9,i=10,l=13,u=39,c=92},17271,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.SettingsMap=void 0,r.SettingsMap=class{constructor(e){Object.defineProperty(this,"record",{enumerable:!0,configurable:!0,writable:!0,value:e})}toString(){return`{${Object.entries(this.record).map(([e,t])=>`'${e}':'${t}'`).join(",")}}`}static from(e){return new this(e)}}},36264,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.formatQuerySettings=function(e){if("boolean"==typeof e)return e?"1":"0";if("number"==typeof e)return String(e);if("string"==typeof e)return e;if(e instanceof n.SettingsMap)return e.toString();throw Error(`Unsupported value in query settings: [${e}].`)};let n=e.r(17271)},26029,(e,t,r)=>{"use strict";var n=e.e&&e.e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);(!o||("get"in o?!t.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=e.e&&e.e.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),r.formatQuerySettings=r.formatQueryParams=r.TupleParam=void 0,o(e.r(93657),r);var a=e.r(5832);Object.defineProperty(r,"TupleParam",{enumerable:!0,get:function(){return a.TupleParam}}),Object.defineProperty(r,"formatQueryParams",{enumerable:!0,get:function(){return a.formatQueryParams}});var s=e.r(36264);Object.defineProperty(r,"formatQuerySettings",{enumerable:!0,get:function(){return s.formatQuerySettings}})},4167,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ClickHouseError=void 0,r.parseError=function(e){let t=e instanceof Error,r=(t?e.message:e).match(n),a=r?.groups;return a?new o(a):t?e:Error(e)},r.getCurrentStackTrace=function(){let e=Error().stack;return e?e.split("\n").slice(3).reverse().join("\n"):""},r.enhanceStackTrace=function(e,t){if(e.stack&&t){let r=e.stack.indexOf("\n"),n=e.stack.substring(0,r),o=e.stack.substring(r+1);e.stack=`${n}
${t}
${o}`}return e};let n=/(Code|Error): (?<code>\d+).*Exception: (?<message>.+)\((?<type>(?=.+[A-Z]{3})[A-Z0-9_]+?)\)/s;class o extends Error{constructor({message:e,code:t,type:r}){super(e),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.code=t,this.type=r,Object.setPrototypeOf(this,o.prototype)}}r.ClickHouseError=o},21238,(e,t,r)=>{"use strict";var n=e.e&&e.e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);(!o||("get"in o?!t.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=e.e&&e.e.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),o(e.r(4167),r)},43365,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.isProgressRow=function(e){return null!==e&&"object"==typeof e&&"progress"in e&&1===Object.keys(e).length},r.isRow=function(e){return null!==e&&"object"==typeof e&&"row"in e&&1===Object.keys(e).length},r.isException=function(e){return null!==e&&"object"==typeof e&&"exception"in e&&1===Object.keys(e).length}},13415,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.SimpleColumnTypes=r.ColumnTypeParseError=void 0,r.parseColumnType=o,r.parseDecimalType=a,r.parseEnumType=s,r.parseMapType=i,r.parseTupleType=l,r.parseArrayType=u,r.parseDateTimeType=c,r.parseDateTime64Type=d,r.parseFixedStringType=p,r.asNullableType=m,r.getElementsTypes=h;class n extends Error{constructor(e,t){super(e),Object.defineProperty(this,"args",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.args=t??{},Object.setPrototypeOf(this,n.prototype)}}function o(e){let t,o=e,h=!1;if(o.startsWith(g)&&(o=o.slice(g.length,-1)),o.startsWith(f)&&(o=o.slice(f.length,-1),h=!0),r.SimpleColumnTypes.includes(o))t={type:"Simple",columnType:o,sourceType:e};else if(o.startsWith(b))t=a({sourceType:e,columnType:o});else if(o.startsWith(P))t=d({sourceType:e,columnType:o});else if(o.startsWith(S))t=c({sourceType:e,columnType:o});else if(o.startsWith(j))t=p({sourceType:e,columnType:o});else if(o.startsWith(v)||o.startsWith(w))t=s({sourceType:e,columnType:o});else if(o.startsWith(y))t=u({sourceType:e,columnType:o});else if(o.startsWith(_))t=i({sourceType:e,columnType:o});else if(o.startsWith(O))t=l({sourceType:e,columnType:o});else throw new n("Unsupported column type",{columnType:o});return h?m(t,e):t}function a({columnType:e,sourceType:t}){if(!e.startsWith(b)||e.length<b.length+5)throw new n("Invalid Decimal type",{sourceType:t,columnType:e});let r=e.slice(b.length,-1).split(", ");if(2!==r.length)throw new n("Expected Decimal type to have both precision and scale",{sourceType:t,columnType:e,split:r});let o=32,a=parseInt(r[0],10);if(Number.isNaN(a)||a<1||a>76)throw new n("Invalid Decimal precision",{columnType:e,sourceType:t,precision:a});let s=parseInt(r[1],10);if(Number.isNaN(s)||s<0||s>a)throw new n("Invalid Decimal scale",{columnType:e,sourceType:t,precision:a,scale:s});return a>38?o=256:a>18?o=128:a>9&&(o=64),{type:"Decimal",params:{precision:a,scale:s,intSize:o},sourceType:t}}function s({columnType:e,sourceType:t}){let r;if(e.startsWith(v))e=e.slice(v.length,-1),r=8;else if(e.startsWith(w))e=e.slice(w.length,-1),r=16;else throw new n("Expected Enum to be either Enum8 or Enum16",{columnType:e,sourceType:t});if(e.length<6)throw new n("Invalid Enum type values",{columnType:e,sourceType:t});let o=[],a=[],s=!0,i=!1,l=1;for(let r=1;r<e.length;r++)if(s){if(i)i=!1;else if(e.charCodeAt(r)===q)i=!0;else if(e.charCodeAt(r)===E){let i=e.slice(l,r);if(o.includes(i))throw new n("Duplicate Enum name",{columnType:e,sourceType:t,name:i,names:o,indices:a});o.push(i),r+=4,l=r,s=!1}}else(e.charCodeAt(r)<N||e.charCodeAt(r)>A)&&(c(l,r),r+=2,l=r+1,s=!0,i=!1);if(c(l,e.length),o.length!==a.length)throw new n("Expected Enum to have the same number of names and indices",{columnType:e,sourceType:t,names:o,indices:a});let u={};for(let e=0;e<o.length;e++)u[a[e]]=o[e];return{type:"Enum",values:u,intSize:r,sourceType:t};function c(r,s){let i=parseInt(e.slice(r,s),10);if(Number.isNaN(i)||i<0)throw new n("Expected Enum index to be a valid number",{columnType:e,sourceType:t,names:o,indices:a,index:i,start:r,end:s});if(a.includes(i))throw new n("Duplicate Enum index",{columnType:e,sourceType:t,index:i,names:o,indices:a});a.push(i)}}function i({columnType:e,sourceType:t}){if(!e.startsWith(_)||e.length<_.length+11)throw new n("Invalid Map type",{columnType:e,sourceType:t});let[r,a]=h({columnType:e=e.slice(_.length,-1),sourceType:t},2),s=o(r);if("DateTime64"===s.type||"Nullable"===s.type||"Array"===s.type||"Map"===s.type||"Decimal"===s.type||"Tuple"===s.type)throw new n("Invalid Map key type",{key:s,sourceType:t});return{type:"Map",key:s,value:o(a),sourceType:t}}function l({columnType:e,sourceType:t}){if(!e.startsWith(O)||e.length<O.length+5)throw new n("Invalid Tuple type",{columnType:e,sourceType:t});return{type:"Tuple",elements:h({columnType:e=e.slice(O.length,-1),sourceType:t},1).map(e=>o(e)),sourceType:t}}function u({columnType:e,sourceType:t}){if(!e.startsWith(y)||e.length<y.length+5)throw new n("Invalid Array type",{columnType:e,sourceType:t});let r=0;for(;e.length>0;)if(e.startsWith(y))e=e.slice(y.length,-1),r++;else break;if(0===r||r>10)throw new n("Expected Array to have between 1 and 10 dimensions",{columnType:e});let a=o(e);if("Array"===a.type)throw new n("Unexpected Array as value type",{columnType:e,sourceType:t});return{type:"Array",value:a,dimensions:r,sourceType:t}}function c({columnType:e,sourceType:t}){if(e.startsWith(C)&&e.length>C.length+4)return{type:"DateTime",timezone:e.slice(C.length+1,-2),sourceType:t};if(e.startsWith(S)&&e.length===S.length)return{type:"DateTime",timezone:null,sourceType:t};throw new n("Invalid DateTime type",{columnType:e,sourceType:t})}function d({columnType:e,sourceType:t}){if(!e.startsWith(P)||e.length<P.length+2)throw new n("Invalid DateTime64 type",{columnType:e,sourceType:t});let r=parseInt(e[P.length],10);if(Number.isNaN(r)||r<0||r>9)throw new n("Invalid DateTime64 precision",{columnType:e,sourceType:t,precision:r});let o=null;return e.length>P.length+2&&(o=e.slice(P.length+4,-2)),{type:"DateTime64",timezone:o,precision:r,sourceType:t}}function p({columnType:e,sourceType:t}){if(!e.startsWith(j)||e.length<j.length+2)throw new n("Invalid FixedString type",{columnType:e,sourceType:t});let r=parseInt(e.slice(j.length,-1),10);if(Number.isNaN(r)||r<1)throw new n("Invalid FixedString size in bytes",{columnType:e,sourceType:t,sizeBytes:r});return{type:"FixedString",sizeBytes:r,sourceType:t}}function m(e,t){if("Array"===e.type||"Map"===e.type||"Tuple"===e.type||"Nullable"===e.type)throw new n(`${e.type} cannot be Nullable`,{sourceType:t});return e.sourceType.startsWith(f)&&(e.sourceType=e.sourceType.slice(f.length,-1)),{type:"Nullable",sourceType:t,value:e}}function h({columnType:e,sourceType:t},r){let o=[],a=0,s=!1,i=!1,l=0;for(let t=0;t<e.length;t++)i?i=!1:e.charCodeAt(t)===q?i=!0:e.charCodeAt(t)===E?s=!s:!s&&(e.charCodeAt(t)===k?a++:e.charCodeAt(t)===R?a--:e.charCodeAt(t)===T&&0===a&&(o.push(e.slice(l,t)),t+=2,l=t));if(!a&&l<e.length-1&&o.push(e.slice(l)),o.length<r)throw new n("Expected more elements in the type",{sourceType:t,columnType:e,elements:o,minElements:r});return o}r.ColumnTypeParseError=n,r.SimpleColumnTypes=["Bool","UInt8","Int8","UInt16","Int16","UInt32","Int32","UInt64","Int64","UInt128","Int128","UInt256","Int256","Float32","Float64","String","UUID","Date","Date32","IPv4","IPv6"];let f="Nullable(",g="LowCardinality(",b="Decimal(",y="Array(",_="Map(",v="Enum8(",w="Enum16(",O="Tuple(",S="DateTime",C="DateTime(",P="DateTime64(",j="FixedString(",E=39,k=40,R=41,T=44,N=48,A=57,q=92},49964,(e,t,r)=>{"use strict";var n=e.e&&e.e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);(!o||("get"in o?!t.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=e.e&&e.e.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),o(e.r(13415),r),o(e.r(62535),r)},35271,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.EXCEPTION_TAG_HEADER_NAME=void 0,r.withCompressionHeaders=function({headers:e,enable_request_compression:t,enable_response_compression:r}){return{...e,...r?{"Accept-Encoding":"gzip"}:{},...t?{"Content-Encoding":"gzip"}:{}}},r.withHttpSettings=function(e,t){return{...t?{enable_http_compression:1}:{},...e}},r.isSuccessfulResponse=function(e){return!!(e&&200<=e&&e<300)},r.isJWTAuth=function(e){return null!==e&&"object"==typeof e&&"access_token"in e},r.isCredentialsAuth=function(e){return null!==e&&"object"==typeof e&&"username"in e&&"password"in e},r.EXCEPTION_TAG_HEADER_NAME="x-clickhouse-exception-tag"},18677,(e,t,r)=>{"use strict";async function n(e){await new Promise(t=>setTimeout(()=>{t(void 0)},e))}Object.defineProperty(r,"__esModule",{value:!0}),r.sleep=n},46785,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.checkErrorInChunkAtIndex=function(e,t,r){if(t>0&&13===e[t-1]&&void 0!==r)try{let t=new TextDecoder("utf-8"),o=16+r.length+2,a=e.length-o;if(a<1)return Error("there was an error in the stream, but the last chunk is malformed");do--a;while(10!==e[a])let s=parseInt(t.decode(e.subarray(a,-o)));if(isNaN(s)||s<=0)return Error("there was an error in the stream; failed to parse the message length");let i=t.decode(e.subarray(a-s+1,a));return(0,n.parseError)(i)}catch(e){return e}};let n=e.r(21238)},9326,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.transformUrl=function({url:e,pathname:t,searchParams:r}){let n=new URL(e);return t&&("/"===n.pathname?n.pathname=t:n.pathname+=t),r&&(n.search=r?.toString()),n},r.toSearchParams=function({database:e,query:t,query_params:r,clickhouse_settings:o,session_id:a,query_id:s,role:i}){let l=[["query_id",s]];if(void 0!==r)for(let[e,t]of Object.entries(r)){let r=(0,n.formatQueryParams)({value:t});l.push([`param_${e}`,r])}if(void 0!==o)for(let[e,t]of Object.entries(o))void 0!==t&&l.push([e,(0,n.formatQuerySettings)(t)]);if(void 0!==e&&"default"!==e&&l.push(["database",e]),t&&l.push(["query",t]),a&&l.push(["session_id",a]),i){if("string"==typeof i)l.push(["role",i]);else if(Array.isArray(i))for(let e of i)l.push(["role",e])}return new URLSearchParams(l)};let n=e.r(26029)},44353,(e,t,r)=>{"use strict";var n=e.e&&e.e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);(!o||("get"in o?!t.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=e.e&&e.e.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),o(e.r(35271),r),o(e.r(18677),r),o(e.r(46785),r),o(e.r(9326),r)},81360,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.enhanceStackTrace=r.getCurrentStackTrace=r.DefaultLogger=r.LogWriter=r.checkErrorInChunkAtIndex=r.isJWTAuth=r.isCredentialsAuth=r.withHttpSettings=r.withCompressionHeaders=r.transformUrl=r.toSearchParams=r.sleep=r.isSuccessfulResponse=r.EXCEPTION_TAG_HEADER_NAME=r.numberConfigURLValue=r.getConnectionParams=r.enumConfigURLValue=r.booleanConfigURLValue=r.validateStreamFormat=r.isNotStreamableJSONFamily=r.isStreamableJSONFamily=r.isSupportedRawFormat=r.encodeJSON=r.formatQueryParams=r.formatQuerySettings=r.defaultJSONHandling=r.parseColumnType=r.SimpleColumnTypes=r.SettingsMap=r.isException=r.isRow=r.isProgressRow=r.ClickHouseLogLevel=r.parseError=r.ClickHouseError=r.TupleParam=r.ClickHouseClient=void 0;var n=e.r(74615);Object.defineProperty(r,"ClickHouseClient",{enumerable:!0,get:function(){return n.ClickHouseClient}});var o=e.r(26029);Object.defineProperty(r,"TupleParam",{enumerable:!0,get:function(){return o.TupleParam}});var a=e.r(21238);Object.defineProperty(r,"ClickHouseError",{enumerable:!0,get:function(){return a.ClickHouseError}}),Object.defineProperty(r,"parseError",{enumerable:!0,get:function(){return a.parseError}});var s=e.r(80886);Object.defineProperty(r,"ClickHouseLogLevel",{enumerable:!0,get:function(){return s.ClickHouseLogLevel}});var i=e.r(43365);Object.defineProperty(r,"isProgressRow",{enumerable:!0,get:function(){return i.isProgressRow}}),Object.defineProperty(r,"isRow",{enumerable:!0,get:function(){return i.isRow}}),Object.defineProperty(r,"isException",{enumerable:!0,get:function(){return i.isException}});var l=e.r(17271);Object.defineProperty(r,"SettingsMap",{enumerable:!0,get:function(){return l.SettingsMap}});var u=e.r(49964);Object.defineProperty(r,"SimpleColumnTypes",{enumerable:!0,get:function(){return u.SimpleColumnTypes}}),Object.defineProperty(r,"parseColumnType",{enumerable:!0,get:function(){return u.parseColumnType}}),Object.defineProperty(r,"defaultJSONHandling",{enumerable:!0,get:function(){return u.defaultJSONHandling}});var c=e.r(26029);Object.defineProperty(r,"formatQuerySettings",{enumerable:!0,get:function(){return c.formatQuerySettings}}),Object.defineProperty(r,"formatQueryParams",{enumerable:!0,get:function(){return c.formatQueryParams}}),Object.defineProperty(r,"encodeJSON",{enumerable:!0,get:function(){return c.encodeJSON}}),Object.defineProperty(r,"isSupportedRawFormat",{enumerable:!0,get:function(){return c.isSupportedRawFormat}}),Object.defineProperty(r,"isStreamableJSONFamily",{enumerable:!0,get:function(){return c.isStreamableJSONFamily}}),Object.defineProperty(r,"isNotStreamableJSONFamily",{enumerable:!0,get:function(){return c.isNotStreamableJSONFamily}}),Object.defineProperty(r,"validateStreamFormat",{enumerable:!0,get:function(){return c.validateStreamFormat}});var d=e.r(36135);Object.defineProperty(r,"booleanConfigURLValue",{enumerable:!0,get:function(){return d.booleanConfigURLValue}}),Object.defineProperty(r,"enumConfigURLValue",{enumerable:!0,get:function(){return d.enumConfigURLValue}}),Object.defineProperty(r,"getConnectionParams",{enumerable:!0,get:function(){return d.getConnectionParams}}),Object.defineProperty(r,"numberConfigURLValue",{enumerable:!0,get:function(){return d.numberConfigURLValue}});var p=e.r(44353);Object.defineProperty(r,"EXCEPTION_TAG_HEADER_NAME",{enumerable:!0,get:function(){return p.EXCEPTION_TAG_HEADER_NAME}}),Object.defineProperty(r,"isSuccessfulResponse",{enumerable:!0,get:function(){return p.isSuccessfulResponse}}),Object.defineProperty(r,"sleep",{enumerable:!0,get:function(){return p.sleep}}),Object.defineProperty(r,"toSearchParams",{enumerable:!0,get:function(){return p.toSearchParams}}),Object.defineProperty(r,"transformUrl",{enumerable:!0,get:function(){return p.transformUrl}}),Object.defineProperty(r,"withCompressionHeaders",{enumerable:!0,get:function(){return p.withCompressionHeaders}}),Object.defineProperty(r,"withHttpSettings",{enumerable:!0,get:function(){return p.withHttpSettings}}),Object.defineProperty(r,"isCredentialsAuth",{enumerable:!0,get:function(){return p.isCredentialsAuth}}),Object.defineProperty(r,"isJWTAuth",{enumerable:!0,get:function(){return p.isJWTAuth}}),Object.defineProperty(r,"checkErrorInChunkAtIndex",{enumerable:!0,get:function(){return p.checkErrorInChunkAtIndex}});var m=e.r(80886);Object.defineProperty(r,"LogWriter",{enumerable:!0,get:function(){return m.LogWriter}}),Object.defineProperty(r,"DefaultLogger",{enumerable:!0,get:function(){return m.DefaultLogger}});var h=e.r(21238);Object.defineProperty(r,"getCurrentStackTrace",{enumerable:!0,get:function(){return h.getCurrentStackTrace}}),Object.defineProperty(r,"enhanceStackTrace",{enumerable:!0,get:function(){return h.enhanceStackTrace}})},54799,(e,t,r)=>{t.exports=e.x("crypto",()=>require("crypto"))},88947,(e,t,r)=>{t.exports=e.x("stream",()=>require("stream"))},6461,(e,t,r)=>{t.exports=e.x("zlib",()=>require("zlib"))},874,(e,t,r)=>{t.exports=e.x("buffer",()=>require("buffer"))},79894,(e,t,r)=>{"use strict";var n=e.e&&e.e.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.isStream=function(e){return"object"==typeof e&&null!==e&&"pipe"in e&&"function"==typeof e.pipe&&"on"in e&&"function"==typeof e.on},r.getAsText=s,r.mapStream=function(e){return new o.default.Transform({objectMode:!0,transform(t,r,n){n(null,e(t))}})};let o=n(e.r(88947)),{MAX_STRING_LENGTH:a}=e.r(874).constants;async function s(e){let t="",r=new TextDecoder;for await(let n of e){let e=r.decode(n,{stream:!0});if(e.length+t.length>a)throw Error(`The response length exceeds the maximum allowed size of V8 String: ${a}; consider limiting the amount of requested rows.`);t+=e}let n=r.decode();return n&&(t+=n),t}},49783,(e,t,r)=>{"use strict";var n=e.e&&e.e.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.NodeValuesEncoder=void 0;let o=e.r(81360),a=n(e.r(88947)),s=e.r(79894);function i(e){e&&console.error(e)}r.NodeValuesEncoder=class{constructor(e){Object.defineProperty(this,"json",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.json=e}encodeValues(e,t){if((0,s.isStream)(e))return e.readableObjectMode?a.default.pipeline(e,(0,s.mapStream)(e=>(0,o.encodeJSON)(e,t,this.json.stringify)),i):e;if(Array.isArray(e))return e.map(e=>(0,o.encodeJSON)(e,t,this.json.stringify)).join("");if("object"==typeof e)return(0,o.encodeJSON)(e,t,this.json.stringify);throw Error(`Cannot encode values of type ${typeof e} with ${t} format`)}validateInsertValues(e,t){if(!Array.isArray(e)&&!(0,s.isStream)(e)&&"object"!=typeof e)throw Error(`Insert expected "values" to be an array, a stream of values or a JSON object, got: ${typeof e}`);if((0,s.isStream)(e)){if((0,o.isSupportedRawFormat)(t)){if(e.readableObjectMode)throw Error(`Insert for ${t} expected Readable Stream with disabled object mode.`)}else if(!e.readableObjectMode)throw Error(`Insert for ${t} expected Readable Stream with enabled object mode.`)}}}},59528,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getProcessVersion=function(){return process.version}},60526,(e,t,r)=>{t.exports=e.x("node:os",()=>require("node:os"))},15653,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default="1.15.0"},95425,(e,t,r)=>{"use strict";var n,o=e.e&&e.e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);(!o||("get"in o?!t.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),a=e.e&&e.e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=e.e&&e.e.__importStar||(n=function(e){return(n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t})(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return a(t,e),t}),i=e.e&&e.e.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.Runtime=void 0;let l=s(e.r(60526)),u=i(e.r(15653));class c{}r.Runtime=c,Object.defineProperty(c,"package",{enumerable:!0,configurable:!0,writable:!0,value:u.default}),Object.defineProperty(c,"node",{enumerable:!0,configurable:!0,writable:!0,value:process.version}),Object.defineProperty(c,"os",{enumerable:!0,configurable:!0,writable:!0,value:l.platform()})},94675,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getUserAgent=function(e){let t=`clickhouse-js/${n.Runtime.package} (lv:nodejs/${n.Runtime.node}; os:${n.Runtime.os})`;return e?`${e} ${t}`:t};let n=e.r(95425)},9793,(e,t,r)=>{"use strict";var n=e.e&&e.e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);(!o||("get"in o?!t.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=e.e&&e.e.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),o(e.r(79894),r),o(e.r(49783),r),o(e.r(59528),r),o(e.r(94675),r)},42026,(e,t,r)=>{"use strict";var n=e.e&&e.e.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.decompressResponse=function(e,t){let r=e.headers["content-encoding"];return"gzip"===r?{response:o.default.pipeline(e,a.default.createGunzip(),function(e){e&&t.error({message:"An error occurred while decompressing the response",err:e})})}:void 0!==r?{error:Error(`Unexpected encoding: ${r}`)}:{response:e}},r.isDecompressionError=function(e){return void 0!==e.error};let o=n(e.r(88947)),a=n(e.r(6461))},1503,(e,t,r)=>{"use strict";async function n(e){return new Promise((t,r)=>{function n(){}function o(){i(),t()}function a(e){i(),r(e)}function s(){i()}function i(){e.removeListener("data",n),e.removeListener("end",o),e.removeListener("error",a),e.removeListener("onClose",s)}e.on("data",n),e.on("end",o),e.on("error",a),e.on("close",s)})}Object.defineProperty(r,"__esModule",{value:!0}),r.drainStream=n},70884,(e,t,r)=>{"use strict";var n=e.e&&e.e.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.NodeBaseConnection=void 0;let o=e.r(81360),a=n(e.r(54799)),s=n(e.r(88947)),i=n(e.r(6461)),l=e.r(9793),u=e.r(42026),c=e.r(1503);r.NodeBaseConnection=class{constructor(e,t){if(Object.defineProperty(this,"params",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"agent",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"defaultAuthHeader",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"defaultHeaders",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"jsonHandling",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logger",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"knownSockets",{enumerable:!0,configurable:!0,writable:!0,value:new WeakMap}),Object.defineProperty(this,"idleSocketTTL",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),"Credentials"===e.auth.type)this.defaultAuthHeader=`Basic ${Buffer.from(`${e.auth.username}:${e.auth.password}`).toString("base64")}`;else if("JWT"===e.auth.type)this.defaultAuthHeader=`Bearer ${e.auth.access_token}`;else throw Error(`Unknown auth type: ${e.auth.type}`);this.defaultHeaders={Connection:this.params.keep_alive.enabled?"keep-alive":"close","User-Agent":(0,l.getUserAgent)(this.params.application_id)},this.logger=e.log_writer,this.idleSocketTTL=e.keep_alive.idle_socket_ttl,this.jsonHandling=e.json??{parse:JSON.parse,stringify:JSON.stringify}}async ping(e){let t,r=this.getQueryId(e.query_id),{controller:n,controllerCleanup:a}=this.getAbortController(e);try{if(e.select){let e=(0,o.toSearchParams)({database:void 0,query:d,query_id:r});t=await this.request({method:"GET",url:(0,o.transformUrl)({url:this.params.url,searchParams:e}),query:d,abort_signal:n.signal,headers:this.buildRequestHeaders()},"Ping")}else t=await this.request({method:"GET",url:(0,o.transformUrl)({url:this.params.url,pathname:"/ping"}),abort_signal:n.signal,headers:this.buildRequestHeaders(),query:"ping"},"Ping");return await (0,c.drainStream)(t.stream),{success:!0}}catch(e){return n.abort("Ping failed"),this.logger.warn({message:this.httpRequestErrorMessage("Ping"),err:e,args:{query_id:r}}),{success:!1,error:e}}finally{a()}}async query(e){let t=this.getQueryId(e.query_id),r=(0,o.withHttpSettings)(e.clickhouse_settings,this.params.compression.decompress_response),n=(0,o.toSearchParams)({database:this.params.database,query_params:e.query_params,session_id:e.session_id,clickhouse_settings:r,query_id:t,role:e.role}),{controller:a,controllerCleanup:s}=this.getAbortController(e),i=1===r.enable_http_compression;try{let{response_headers:r,stream:s}=await this.request({method:"POST",url:(0,o.transformUrl)({url:this.params.url,searchParams:n}),body:e.query,abort_signal:a.signal,enable_response_compression:i,headers:this.buildRequestHeaders(e),query:e.query},"Query");return{stream:s,response_headers:r,query_id:t}}catch(o){throw a.abort("Query HTTP request failed"),this.logRequestError({op:"Query",query_id:t,query_params:e,search_params:n,err:o,extra_args:{decompress_response:i,clickhouse_settings:r}}),o}finally{s()}}async insert(e){let t=this.getQueryId(e.query_id),r=(0,o.toSearchParams)({database:this.params.database,clickhouse_settings:e.clickhouse_settings,query_params:e.query_params,query:e.query,session_id:e.session_id,role:e.role,query_id:t}),{controller:n,controllerCleanup:a}=this.getAbortController(e);try{let{stream:a,summary:s,response_headers:i}=await this.request({method:"POST",url:(0,o.transformUrl)({url:this.params.url,searchParams:r}),body:e.values,abort_signal:n.signal,enable_request_compression:this.params.compression.compress_request,parse_summary:!0,headers:this.buildRequestHeaders(e),query:e.query},"Insert");return await (0,c.drainStream)(a),{query_id:t,summary:s,response_headers:i}}catch(o){throw n.abort("Insert HTTP request failed"),this.logRequestError({op:"Insert",query_id:t,query_params:e,search_params:r,err:o,extra_args:{clickhouse_settings:e.clickhouse_settings??{}}}),o}finally{a()}}async exec(e){return this.runExec({...e,op:"Exec"})}async command(e){let{stream:t,query_id:r,summary:n,response_headers:o}=await this.runExec({...e,op:"Command"});return await (0,c.drainStream)(t),{query_id:r,summary:n,response_headers:o}}async close(){void 0!==this.agent&&void 0!==this.agent.destroy&&this.agent.destroy()}defaultHeadersWithOverride(e){return{...this.params.http_headers??{},...e?.http_headers??{},...this.defaultHeaders}}buildRequestHeaders(e){let t=this.defaultHeadersWithOverride(e);if((0,o.isJWTAuth)(e?.auth))return{...t,Authorization:`Bearer ${e.auth.access_token}`};if(this.params.set_basic_auth_header)if((0,o.isCredentialsAuth)(e?.auth))return{...t,Authorization:`Basic ${Buffer.from(`${e.auth.username}:${e.auth.password}`).toString("base64")}`};else return{...t,Authorization:this.defaultAuthHeader};return{...t}}getQueryId(e){return e||a.default.randomUUID()}getAbortController(e){let t=new AbortController;function r(){t.abort()}return e.abort_signal?.addEventListener("abort",r),{controller:t,controllerCleanup:()=>{e.abort_signal?.removeEventListener("abort",r)}}}logResponse(e,t,r,n,o){let{authorization:a,host:s,...i}=t.getHeaders(),l=Date.now()-o;this.params.log_writer.debug({module:"HTTP Adapter",message:`${e}: got a response from ClickHouse`,args:{request_method:r.method,request_path:r.url.pathname,request_params:r.url.search,request_headers:i,response_status:n.statusCode,response_headers:n.headers,response_time_ms:l}})}logRequestError({op:e,err:t,query_id:r,query_params:n,search_params:o,extra_args:a}){this.logger.error({message:this.httpRequestErrorMessage(e),err:t,args:{query:n.query,search_params:o?.toString()??"",with_abort_signal:void 0!==n.abort_signal,session_id:n.session_id,query_id:r,...a}})}httpRequestErrorMessage(e){return`${e}: HTTP request error.`}parseSummary(e,t){let r=t.headers["x-clickhouse-summary"];if("string"==typeof r)try{return this.jsonHandling.parse(r)}catch(t){this.logger.error({message:`${e}: failed to parse X-ClickHouse-Summary header.`,args:{"X-ClickHouse-Summary":r},err:t})}}async runExec(e){let t=this.getQueryId(e.query_id),r=void 0!==e.values,n=(0,o.withHttpSettings)(e.clickhouse_settings,this.params.compression.decompress_response),a={query:r?e.query:void 0,database:this.params.database,query_params:e.query_params,session_id:e.session_id,role:e.role,clickhouse_settings:n,query_id:t},s=(0,o.toSearchParams)(a),{controller:i,controllerCleanup:l}=this.getAbortController(e),u="Exec"===e.op&&(e.decompress_response_stream??this.params.compression.decompress_response),c=e.ignore_error_response??!1;try{let{stream:n,summary:a,response_headers:l}=await this.request({method:"POST",url:(0,o.transformUrl)({url:this.params.url,searchParams:s}),body:r?e.values:e.query,abort_signal:i.signal,parse_summary:!0,enable_request_compression:this.params.compression.compress_request,enable_response_compression:this.params.compression.decompress_response,try_decompress_response_stream:u,ignore_error_response:c,headers:this.buildRequestHeaders(e),query:e.query},e.op);return{stream:n,query_id:t,summary:a,response_headers:l}}catch(r){throw i.abort(`${e.op} HTTP request failed`),this.logRequestError({op:e.op,query_id:t,query_params:e,search_params:s,err:r,extra_args:{clickhouse_settings:e.clickhouse_settings??{}}}),r}finally{l()}}async request(e,t){await (0,o.sleep)(0);let r=this.params.capture_enhanced_stack_trace?(0,o.getCurrentStackTrace)():void 0,n=this.logger;return new Promise((c,d)=>{let p,m=Date.now(),h=this.createClientRequest(e);function f(e){w(),d((0,o.enhanceStackTrace)(e,r))}let g=async n=>{this.logResponse(t,h,e,n,m);let a=e.try_decompress_response_stream??!0,s=e.ignore_error_response??!1,i=!(0,o.isSuccessfulResponse)(n.statusCode);if(a||i&&!s){let e=(0,u.decompressResponse)(n,this.logger);if((0,u.isDecompressionError)(e))return d((0,o.enhanceStackTrace)(e.error,r));p=e.response}else p=n;if(!i||s)return c({stream:p,summary:e.parse_summary?this.parseSummary(t,n):void 0,response_headers:{...n.headers}});try{let e=await (0,l.getAsText)(p),t=(0,o.enhanceStackTrace)((0,o.parseError)(e),r);d(t)}catch(e){d((0,o.enhanceStackTrace)(e,r))}};function b(){w(),h.once("error",function(){}),d((0,o.enhanceStackTrace)(Error("The user aborted a request."),r))}function y(){w()}let _=u=>{try{if(this.params.keep_alive.enabled&&this.params.keep_alive.idle_socket_ttl>0){let r=this.knownSockets.get(u);if(void 0===r){let r=a.default.randomUUID();this.logger.trace({message:`Using a fresh socket ${r}, setting up a new 'free' listener`}),this.knownSockets.set(u,{id:r,idle_timeout_handle:void 0}),u.on("free",()=>{this.logger.trace({message:`Socket ${r} was released`});let e=setTimeout(()=>{this.logger.trace({message:`Removing socket ${r} after ${this.idleSocketTTL} ms of idle`}),this.knownSockets.delete(u),u.destroy()},this.idleSocketTTL).unref();this.knownSockets.set(u,{id:r,idle_timeout_handle:e})});let n=()=>{let n=this.knownSockets.get(u);n?.idle_timeout_handle&&clearTimeout(n.idle_timeout_handle),this.logger.trace({message:`Socket ${r} was closed or ended, 'free' listener removed`}),p&&!p.readableEnded&&this.logger.warn({message:`${t}: socket was closed or ended before the response was fully read. This can potentially result in an uncaught ECONNRESET error! Consider fully consuming, draining, or destroying the response stream.`,args:{query:e.query,query_id:e.url.searchParams.get("query_id")??"unknown"}})};u.once("end",n),u.once("close",n)}else clearTimeout(r.idle_timeout_handle),this.logger.trace({message:`Reusing socket ${r.id}`}),this.knownSockets.set(u,{...r,idle_timeout_handle:void 0})}}catch(e){n.error({message:"An error occurred while housekeeping the idle sockets",err:e})}!function(){if(h.writableEnded)return;let t=(0,l.isStream)(e.body)?e.body:s.default.Readable.from([e.body]),n=e=>{e&&(w(),d((0,o.enhanceStackTrace)(e,r)))};e.enable_request_compression?s.default.pipeline(t,i.default.createGzip(),h,n):s.default.pipeline(t,h,n)}(),u.setTimeout(this.params.request_timeout,v)};function v(){let e=(0,o.enhanceStackTrace)(Error("Timeout error."),r);w();try{h.destroy()}catch(e){n.error({message:"An error occurred while destroying the request",err:e})}d(e)}function w(){null!==h.socket&&(h.socket.setTimeout(0),h.socket.removeListener("timeout",v)),h.removeListener("socket",_),h.removeListener("response",g),h.removeListener("error",f),h.removeListener("close",y),void 0!==e.abort_signal&&h.removeListener("abort",b)}if(h.on("socket",_),h.on("response",g),h.on("error",f),h.on("close",y),void 0!==e.abort_signal&&e.abort_signal.addEventListener("abort",b,{once:!0}),!e.body)try{return h.end()}catch(e){this.logger.error({message:"An error occurred while ending the request without body",err:e})}})}};let d="SELECT 'ping'"},21517,(e,t,r)=>{t.exports=e.x("http",()=>require("http"))},6630,(e,t,r)=>{"use strict";var n=e.e&&e.e.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.NodeHttpConnection=void 0;let o=e.r(81360),a=n(e.r(21517)),s=e.r(70884);class i extends s.NodeBaseConnection{constructor(e){super(e,new a.default.Agent({keepAlive:e.keep_alive.enabled,maxSockets:e.max_open_connections}))}createClientRequest(e){let t=(0,o.withCompressionHeaders)({headers:e.headers,enable_request_compression:e.enable_request_compression,enable_response_compression:e.enable_response_compression});return a.default.request(e.url,{method:e.method,agent:this.agent,timeout:this.params.request_timeout,signal:e.abort_signal,headers:t})}}r.NodeHttpConnection=i},24836,(e,t,r)=>{t.exports=e.x("https",()=>require("https"))},63712,(e,t,r)=>{"use strict";var n=e.e&&e.e.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.NodeHttpsConnection=void 0;let o=e.r(81360),a=n(e.r(24836)),s=e.r(70884);class i extends s.NodeBaseConnection{constructor(e){super(e,new a.default.Agent({keepAlive:e.keep_alive.enabled,maxSockets:e.max_open_connections,ca:e.tls?.ca_cert,key:e.tls?.type==="Mutual"?e.tls.key:void 0,cert:e.tls?.type==="Mutual"?e.tls.cert:void 0}))}buildRequestHeaders(e){if(void 0!==this.params.tls){let t;if("JWT"===this.params.auth.type)throw Error("JWT auth is not supported with HTTPS connection using custom certificates");t=(0,o.isCredentialsAuth)(e?.auth)?{...this.defaultHeadersWithOverride(e),"X-ClickHouse-User":e.auth.username,"X-ClickHouse-Key":e.auth.password}:{...this.defaultHeadersWithOverride(e),"X-ClickHouse-User":this.params.auth.username,"X-ClickHouse-Key":this.params.auth.password};let r=this.params.tls.type;switch(r){case"Basic":return t;case"Mutual":return{...t,"X-ClickHouse-SSL-Certificate-Auth":"on"};default:throw Error(`Unknown TLS type: ${r}`)}}return super.buildRequestHeaders(e)}createClientRequest(e){let t=(0,o.withCompressionHeaders)({headers:e.headers,enable_request_compression:e.enable_request_compression,enable_response_compression:e.enable_response_compression});return a.default.request(e.url,{method:e.method,agent:this.agent,timeout:this.params.request_timeout,signal:e.abort_signal,headers:t})}}r.NodeHttpsConnection=i},5553,(e,t,r)=>{"use strict";var n=e.e&&e.e.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.NodeCustomAgentConnection=void 0;let o=n(e.r(21517)),a=n(e.r(24836)),s=e.r(70884),i=e.r(81360);class l extends s.NodeBaseConnection{constructor(e){if(!e.http_agent)throw Error("http_agent is required to create NodeCustomAgentConnection");super(e,e.http_agent),Object.defineProperty(this,"httpRequestFn",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e.url.protocol.startsWith("https")?this.httpRequestFn=a.default.request:this.httpRequestFn=o.default.request}createClientRequest(e){let t=(0,i.withCompressionHeaders)({headers:e.headers,enable_request_compression:e.enable_request_compression,enable_response_compression:e.enable_response_compression});return this.httpRequestFn(e.url,{method:e.method,agent:this.agent,timeout:this.params.request_timeout,signal:e.abort_signal,headers:t})}}r.NodeCustomAgentConnection=l},39720,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.NodeConnectionFactory=void 0;let n=e.r(5553),o=e.r(6630),a=e.r(63712);r.NodeConnectionFactory=class{static create({connection_params:e,tls:t,keep_alive:r,http_agent:s,set_basic_auth_header:i,capture_enhanced_stack_trace:l}){if(void 0!==s)return new n.NodeCustomAgentConnection({...e,set_basic_auth_header:i,capture_enhanced_stack_trace:l,keep_alive:r,http_agent:s});switch(e.url.protocol){case"http:":return new o.NodeHttpConnection({...e,set_basic_auth_header:i,capture_enhanced_stack_trace:l,keep_alive:r});case"https:":return new a.NodeHttpsConnection({...e,set_basic_auth_header:i,capture_enhanced_stack_trace:l,keep_alive:r,tls:t});default:throw Error("Only HTTP and HTTPS protocols are supported")}}}},25107,(e,t,r)=>{"use strict";var n=e.e&&e.e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);(!o||("get"in o?!t.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=e.e&&e.e.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),o(e.r(70884),r),o(e.r(6630),r),o(e.r(63712),r),o(e.r(39720),r)},18568,(e,t,r)=>{"use strict";var n,o=e.e&&e.e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);(!o||("get"in o?!t.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),a=e.e&&e.e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=e.e&&e.e.__importStar||(n=function(e){return(n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t})(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return a(t,e),t});Object.defineProperty(r,"__esModule",{value:!0}),r.ResultSet=void 0;let i=e.r(81360),l=e.r(81360),u=e.r(874),c=s(e.r(88947)),d=e.r(9793);class p{constructor(e,t,r,n,o,a){Object.defineProperty(this,"_stream",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"format",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"query_id",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"response_headers",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"exceptionTag",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"log_error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"jsonHandling",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.jsonHandling={...i.defaultJSONHandling,...a},this.log_error=n??(e=>console.error(e)),void 0!==o&&(this.response_headers=Object.freeze(o),this.exceptionTag=o[i.EXCEPTION_TAG_HEADER_NAME])}async text(){if(this._stream.readableEnded)throw Error(m);return(await (0,d.getAsText)(this._stream)).toString()}async json(){if(this._stream.readableEnded)throw Error(m);if((0,l.isStreamableJSONFamily)(this.format)){let e=[];for await(let t of this.stream())for(let r of t)e.push(r.json());return e}if((0,l.isNotStreamableJSONFamily)(this.format)){let e=await (0,d.getAsText)(this._stream);return this.jsonHandling.parse(e)}throw Error(`Cannot decode ${this.format} as JSON`)}stream(){if(this._stream.readableEnded)throw Error(m);(0,l.validateStreamFormat)(this.format);let e=[],t=this.log_error,r=this.exceptionTag,n=this.jsonHandling,o=new c.Transform({transform(t,o,a){let s,l=[],c=-1,d=0;do{c=t.indexOf(10,d);let o=(0,i.checkErrorInChunkAtIndex)(t,c,r);if(o)return a(o);if(-1!==c){e.length>0?(s=u.Buffer.concat([...e,t.subarray(d,c)],e.reduce((e,t)=>e+t.length,0)+c),e=[]):s=t.subarray(d,c);let r=s.toString();l.push({text:r,json:()=>n.parse(r)}),d=c+1}else e.push(t.subarray(d)),l.length>0&&this.push(l)}while(-1!==c)a()},autoDestroy:!0,objectMode:!0});return c.default.pipeline(this._stream,o,function(e){e&&"AbortError"!==e.name&&e.message!==h&&t(e)})}close(){this._stream.destroy(Error(h))}[Symbol.dispose](){this.close()}static instance({stream:e,format:t,query_id:r,log_error:n,response_headers:o,jsonHandling:a}){return new p(e,t,r,n,o,a)}}r.ResultSet=p;let m="Stream has been already consumed",h="ResultSet has been closed"},28362,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.NodeConfigImpl=void 0;let n=e.r(81360),o=e.r(25107),a=e.r(18568),s=e.r(9793);r.NodeConfigImpl={handle_specific_url_params:(e,t)=>{let r={...e},o=new Set,a=new Set,s=[...t.searchParams.keys()];return s.length>0&&s.forEach(e=>{let s=t.searchParams.get(e);"keep_alive_idle_socket_ttl"===e?(void 0===r.keep_alive&&(r.keep_alive={}),r.keep_alive.idle_socket_ttl=(0,n.numberConfigURLValue)({key:e,value:s,min:0}),a.add(e)):o.add(e)}),{config:r,unknown_params:o,handled_params:a}},make_connection:(e,t)=>{let r;void 0!==e.tls&&(r="cert"in e.tls&&"key"in e.tls?{type:"Mutual",...e.tls}:{type:"Basic",...e.tls});let n={enabled:e?.keep_alive?.enabled??!0,idle_socket_ttl:e?.keep_alive?.idle_socket_ttl??2500};return o.NodeConnectionFactory.create({connection_params:t,set_basic_auth_header:e.set_basic_auth_header??!0,capture_enhanced_stack_trace:e.capture_enhanced_stack_trace??!1,http_agent:e.http_agent,keep_alive:n,tls:r})},values_encoder:e=>new s.NodeValuesEncoder(e),make_result_set:(e,t,r,n,o,s)=>a.ResultSet.instance({stream:e,format:t,query_id:r,log_error:n,response_headers:o,jsonHandling:s})}},79109,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.NodeClickHouseClient=void 0,r.createClient=function(e){return new n.ClickHouseClient({impl:o.NodeConfigImpl,...e||{}})};let n=e.r(81360),o=e.r(28362);class a extends n.ClickHouseClient{query(e){return super.query(e)}}r.NodeClickHouseClient=a},34256,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.TupleParam=r.isException=r.isRow=r.isProgressRow=r.SimpleColumnTypes=r.parseColumnType=r.SettingsMap=r.ClickHouseLogLevel=r.parseError=r.ClickHouseError=r.drainStream=r.ResultSet=r.createClient=r.ClickHouseClient=void 0;var n=e.r(79109);Object.defineProperty(r,"ClickHouseClient",{enumerable:!0,get:function(){return n.NodeClickHouseClient}});var o=e.r(79109);Object.defineProperty(r,"createClient",{enumerable:!0,get:function(){return o.createClient}});var a=e.r(18568);Object.defineProperty(r,"ResultSet",{enumerable:!0,get:function(){return a.ResultSet}});var s=e.r(1503);Object.defineProperty(r,"drainStream",{enumerable:!0,get:function(){return s.drainStream}});var i=e.r(81360);Object.defineProperty(r,"ClickHouseError",{enumerable:!0,get:function(){return i.ClickHouseError}}),Object.defineProperty(r,"parseError",{enumerable:!0,get:function(){return i.parseError}}),Object.defineProperty(r,"ClickHouseLogLevel",{enumerable:!0,get:function(){return i.ClickHouseLogLevel}}),Object.defineProperty(r,"SettingsMap",{enumerable:!0,get:function(){return i.SettingsMap}}),Object.defineProperty(r,"parseColumnType",{enumerable:!0,get:function(){return i.parseColumnType}}),Object.defineProperty(r,"SimpleColumnTypes",{enumerable:!0,get:function(){return i.SimpleColumnTypes}}),Object.defineProperty(r,"isProgressRow",{enumerable:!0,get:function(){return i.isProgressRow}}),Object.defineProperty(r,"isRow",{enumerable:!0,get:function(){return i.isRow}}),Object.defineProperty(r,"isException",{enumerable:!0,get:function(){return i.isException}}),Object.defineProperty(r,"TupleParam",{enumerable:!0,get:function(){return i.TupleParam}})},58164,e=>{"use strict";var t=e.i(47909),r=e.i(74017),n=e.i(96250),o=e.i(59756),a=e.i(61916),s=e.i(74677),i=e.i(69741),l=e.i(16795),u=e.i(87718),c=e.i(95169),d=e.i(47587),p=e.i(66012),m=e.i(70101),h=e.i(26937),f=e.i(10372),g=e.i(93695);e.i(52474);var b=e.i(220),y=e.i(89171),_=e.i(34256);async function v(){let e=(0,_.createClient)({host:process.env.CLICKHOUSE_HOST||"http://clickhouse:8123",username:process.env.CLICKHOUSE_USER||"default",password:process.env.CLICKHOUSE_PASSWORD||"clickhouse_password",database:process.env.CLICKHOUSE_DB||"blockchain_data"}),t=`
    SELECT
      source,
      record_type,
      COUNT(*) as count
    FROM
      blockchain_raw_data
    GROUP BY
      source, record_type
    ORDER BY
      source, record_type
  `;try{let r=await e.query({query:t,format:"JSONEachRow"});return await r.json()}catch(e){throw console.error("ClickHouse query error:",e),e}finally{await e.close()}}async function w(){try{let e=await v(),t={bitcoin_blocks:0,bitcoin_transactions:0,solana_blocks:0,solana_transactions:0,total_records:0};return e.forEach(e=>{let r=parseInt(e.count,10),n=`${e.source.toLowerCase()}_${e.record_type.toLowerCase()}`;n in t&&(t[n]=r,t.total_records+=r)}),y.NextResponse.json(t)}catch(t){let e=t instanceof Error?t.message:"Unknown error";return console.error("API /data error:",e),y.NextResponse.json({error:`Failed to fetch blockchain data: ${e}`},{status:500})}}e.s(["GET",()=>w],56305);var O=e.i(56305);let S=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/data/route",pathname:"/api/data",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/data/route.ts",nextConfigOutput:"standalone",userland:O}),{workAsyncStorage:C,workUnitAsyncStorage:P,serverHooks:j}=S;function E(){return(0,n.patchFetch)({workAsyncStorage:C,workUnitAsyncStorage:P})}async function k(e,t,n){S.isDev&&(0,o.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let y="/api/data/route";y=y.replace(/\/index$/,"")||"/";let _=await S.prepare(e,t,{srcPage:y,multiZoneDraftMode:!1});if(!_)return t.statusCode=400,t.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve()),null;let{buildId:v,params:w,nextConfig:O,parsedUrl:C,isDraftMode:P,prerenderManifest:j,routerServerContext:E,isOnDemandRevalidate:k,revalidateOnlyGenerated:R,resolvedPathname:T,clientReferenceManifest:N,serverActionsManifest:A}=_,q=(0,i.normalizeAppPath)(y),H=!!(j.dynamicRoutes[q]||j.routes[T]),x=async()=>((null==E?void 0:E.render404)?await E.render404(e,t,C,!1):t.end("This page could not be found"),null);if(H&&!P){let e=!!j.routes[T],t=j.dynamicRoutes[q];if(t&&!1===t.fallback&&!e){if(O.experimental.adapterPath)return await x();throw new g.NoFallbackError}}let M=null;!H||S.isDev||P||(M="/index"===(M=T)?"/":M);let I=!0===S.isDev||!H,L=H&&!I;A&&N&&(0,s.setManifestsSingleton)({page:y,clientReferenceManifest:N,serverActionsManifest:A});let U=e.method||"GET",$=(0,a.getTracer)(),D=$.getActiveScopeSpan(),F={params:w,prerenderManifest:j,renderOpts:{experimental:{authInterrupts:!!O.experimental.authInterrupts},cacheComponents:!!O.cacheComponents,supportsDynamicResponse:I,incrementalCache:(0,o.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:O.cacheLife,waitUntil:n.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,n,o)=>S.onRequestError(e,t,n,o,E)},sharedContext:{buildId:v}},J=new l.NodeNextRequest(e),W=new l.NodeNextResponse(t),B=u.NextRequestAdapter.fromNodeNextRequest(J,(0,u.signalFromNodeResponse)(t));try{let s=async e=>S.handle(B,F).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=$.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=r.get("next.route");if(n){let t=`${U} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${U} ${y}`)}),i=!!(0,o.getRequestMeta)(e,"minimalMode"),l=async o=>{var a,l;let u=async({previousCacheEntry:r})=>{try{if(!i&&k&&R&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await s(o);e.fetchMetrics=F.renderOpts.fetchMetrics;let l=F.renderOpts.pendingWaitUntil;l&&n.waitUntil&&(n.waitUntil(l),l=void 0);let u=F.renderOpts.collectedTags;if(!H)return await (0,p.sendResponse)(J,W,a,F.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(a.headers);u&&(t[f.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==F.renderOpts.collectedRevalidate&&!(F.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&F.renderOpts.collectedRevalidate,n=void 0===F.renderOpts.collectedExpire||F.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:F.renderOpts.collectedExpire;return{value:{kind:b.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:n}}}}catch(t){throw(null==r?void 0:r.isStale)&&await S.onRequestError(e,t,{routerKind:"App Router",routePath:y,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:L,isOnDemandRevalidate:k})},!1,E),t}},c=await S.handleResponse({req:e,nextConfig:O,cacheKey:M,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:j,isRoutePPREnabled:!1,isOnDemandRevalidate:k,revalidateOnlyGenerated:R,responseGenerator:u,waitUntil:n.waitUntil,isMinimalMode:i});if(!H)return null;if((null==c||null==(a=c.value)?void 0:a.kind)!==b.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(l=c.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",k?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),P&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let g=(0,m.fromNodeOutgoingHttpHeaders)(c.value.headers);return i&&H||g.delete(f.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||g.get("Cache-Control")||g.set("Cache-Control",(0,h.getCacheControlHeader)(c.cacheControl)),await (0,p.sendResponse)(J,W,new Response(c.value.body,{headers:g,status:c.value.status||200})),null};D?await l(D):await $.withPropagatedContext(e.headers,()=>$.trace(c.BaseServerSpan.handleRequest,{spanName:`${U} ${y}`,kind:a.SpanKind.SERVER,attributes:{"http.method":U,"http.target":e.url}},l))}catch(t){if(t instanceof g.NoFallbackError||await S.onRequestError(e,t,{routerKind:"App Router",routePath:q,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:L,isOnDemandRevalidate:k})},!1,E),H)throw t;return await (0,p.sendResponse)(J,W,new Response(null,{status:500})),null}}e.s(["handler",()=>k,"patchFetch",()=>E,"routeModule",()=>S,"serverHooks",()=>j,"workAsyncStorage",()=>C,"workUnitAsyncStorage",()=>P],58164)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__108b191a._.js.map